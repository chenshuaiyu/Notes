# Binder

### 1. Binder到底是什么

中文即 粘合剂，意思是粘合了两个不同的进程。

### 2. Linux知识

#### 2.1 进程空间划分

一个进程空间分为**用户空间**和**内核空间**（Kernel），即把进程内用户和内核隔离开来。

区别：

1. 进程间，用户空间的数据不可共享，所以用户空间 = 不可共享空间。
2. 进程间，内核空间的数据可共享，所以内核空间 = 可共享空间。

所以进程共用1个内核空间。

进程内用户空间和内核空间进行交互需通过**系统调用**，主要通过函数：

1. copy_from_user()：将用户空间的数据拷贝到内核空间。
2. copy_to_user()：将内核空间的数据拷贝到用户空间。

![用户和内核空间](https://github.com/chenshuaiyu/Notes/blob/master/Android/Android进阶/assets/用户和内核空间.png)

#### 2.2 进程隔离和扩进程通信（IPC）

- 进程隔离：为了保证安全性和独立性，一个进程不能直接操作或者访问另一个进程，即Android的进程是相互独立的、隔离的。
- 扩进程通信（IPC）：即进程间需进行数据交互、通信。

跨进程通信：

工作流程：

1. 发送进程通过系统调用，将需发送的数据拷贝到Linux进程的内核空间中的缓存区中（数据拷贝1次，通过copy_from_user()）。
2. 内核服务程序唤醒接收进程的接收线程，通过系统调用将数据发送到接收进程的用户空间，最终完成数据发送（数据拷贝2次，通过copy_to_user()）。

缺点：

1. 效率低下，因需做2次数据拷贝，用户空间->内核空间->用户空间。
2. 接收数据的缓存由接收方提供，但接收方却不知道到底有多大的缓存才能满足需求。